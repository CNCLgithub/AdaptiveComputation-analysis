---
title: "Exp 1"
output: html_notebook
---

# Setup

imports

```{r}
library(tidyverse)
library(estimatr)
library(ggplot2)
library(readr)

th <- theme_classic()
theme_set(th)
```

load data (subject, exp, scenes)

```{r}
# when running debug trials
subject_data <- read_csv("data/parsed_trials.csv") %>%
  separate(TrialName, c("trial", NA)) %>%
  mutate(trial = as.numeric(trial),
         is_target = TRUE,
         correct_td = TRUE)

# when running real trials
# subject_data <- read_csv("data/parsed_trials.csv") %>%
#   separate(TrialName, c("trial", "marked", NA), sep = "[(.?:)]") %>%
#   mutate(trial = as.numeric(trial),
#          is_target = as.numeric(marked) <= 4,
#          correct_td = TARGET == is_target)

exp_data <- read_csv("data/exp1.csv") %>%
  mutate(trial = 1:NROW(.),
         has_probe = unique_id <= 10,
         is_high_att = (trial %% 2 == 1))

# motion_data <- read_csv("data/motion.csv")

```



screen bad subjects


```{r}
good_subjects_ids <- subject_data %>%
  group_by(ID) %>%
  summarise(td_acc = 1.0, #mean(correct),
            n = n(),
            td_se = 0, # sd(correct)/sqrt(n),
            passed = (td_acc - td_se) > 0.5) %>%
  filter(passed)

good_subjects_data <- subject_data %>%
  filter(ID %in% good_subjects_ids$ID)


# human_summary <- good_subjects_data %>%
#   summarise(
#     avg_acc = mean(correct),
#     n = n(),
#     se_acc = sd(correct) / sqrt(n))
# 
# write.csv(human_summary, file = "output/human_summary.csv")
```

## Analysis


Average subject performance by trial
```{r}
across_subjects <- good_subjects_data %>%
  group_by(trial) %>%
  summarise(avg_td_acc = mean(correct_td),
            avg_pb = mean(Probe),
            n = n(),
            td_se = sd(correct_td)/sqrt(n),
            pb_se = sd(Probe)/sqrt(n))
```

Merge human performance with trial data (trial data = spring, sigma, attention ...)

```{r}
full_data <- left_join(across_subjects, exp_data, 
                       by = "trial")
```

Measure effect of probe design on subject probe detection

```{r}

full_data %>%
  group_by(is_high_att, has_probe) %>%
  summarise(hit = mean(avg_pb))

full_data %>%
  ggplot(aes(y = avg_pb, x = att, color = is_high_att)) + 
  geom_point()
# 
# human_pd_by_design <- with(full_data, 
#                            lm_robust(avg_pb_acc ~ attention + avg_td_acc))
```

Optionally we can do a logit regression

```{r}

#human_pd_by_design_logit <- with(full_data,
#                             lm_robust(avg_pb_acc ~ ))
```